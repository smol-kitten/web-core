ARG BASE_IMAGE=prep_apache2:24.04
FROM ${BASE_IMAGE}

# Install imagick via PECL for apache2-based images
# This is done once in the prep image to avoid rebuilding for every variant
RUN apt-get update && \
    apt-get install -y \
        libmagickwand-dev \
        imagemagick \
        php8.4-dev \
        php-pear \
        build-essential && \
    pecl install imagick && \
    echo "extension=imagick.so" > /etc/php/8.4/mods-available/imagick.ini && \
    phpenmod imagick && \
    apt-get purge -y build-essential php8.4-dev php-pear && \
    apt-get autoremove -y && \
    apt-get clean && \
    rm -rf /var/lib/apt/lists/* /tmp/pear
