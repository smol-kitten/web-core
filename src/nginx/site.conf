server {
    listen 3000 reuseport default_server;
    server_name localhost _;
    root   /var/www/html;
    index  index.php index.htm index.html;

    access_log              /var/log/nginx/access.log combined buffer=512k flush=1m;
    error_log               /var/log/nginx/error.log warn;


    location / {
        try_files $uri $uri/ =404;
    }
    location ~ \.php$ {
        include snippets/fastcgi-php.conf;
        fastcgi_pass unix:/var/run/php/php8.4-fpm.sock;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        fastcgi_buffers               8 16k;
        fastcgi_buffer_size           32k;
        include fastcgi_params;
    }

    location ~ /\.(?!well-known) {
        deny all;
    }

    #prevent basic source code leaks
    location ~ \.git {
        deny all;
    }
    location ~ \.svn {
        deny all;
    }
    
    # Disallow .conf.php
    location ~ \.conf\.php$ {
        deny all;
    }

    # Prevent access to sensitive files
    location ~* \.(ini|log|conf|bak|swp|old|orig|save|sql|sh|inc|env|dmp)$ {
        deny all;
    }

    # Disable directory listing
    autoindex off;

    # Security headers
    add_header X-Content-Type-Options nosniff;
    add_header X-XSS-Protection "1; mode=block";
    add_header X-Frame-Options SAMEORIGIN;
}

